sap.ui.define(["./BaseController","sap/ui/Device","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/Popover","sap/m/Button","sap/m/library"],function(e,t,o,n,a,s,i){"use strict";var r=i.ButtonType,l=i.PlacementType;return e.extend("frontend.bbs.controller.BBSSAPAddOnDashboard",{_bExpanded:false,getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onInit:async function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local);var o=e.get("jwt");var a=await this.getOwnerComponent().checkToken(o,i);if(a.status=="Error"){window.location.href="../index.html";return}this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());var s=this.getOwnerComponent().getModel("navigationList");this.getView().setModel(s);this._setToggleButtonTooltip(!t.system.desktop);var i=this.getRouter().getHashChanger().getHash();console.log(a);var r=new n({userName:a.data.user.name,roleId:a.data.user.role_id,roleName:a.data.role[0].name});this.getOwnerComponent().setModel(r,"userModel");this.getView().setModel(r,"view");t.media.attachHandler(this._handleWindowResize,this);this.getRouter().attachRouteMatched(this.onRouteChange.bind(this));this.getOwnerComponent().getModel("navigationList").setProperty("/selectedKey",i)},onRouteChange:function(e){this.getOwnerComponent().getModel("navigationList").setProperty("/selectedKey",e.getParameter("name"));if(t.system.phone){this.onSideNavButtonPress()}},onLogoutItemSelect:function(e){var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);var o=t.get("jwt");console.log(o);var n=this.getRouter();$.ajax({url:backendUrl+"logout",type:"POST",headers:{Authorization:"Bearer "+o},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){jQuery.sap.storage.clear();window.location.href="../index.html"},statusCode:{401:function(e,t,o){window.location.href="../index.html"},404:function(e,t,o){loginErrorToast.show()}}})},onParentItemSelect:function(e){var t=e.getSource();var o=this.getRouter();if(t.getItems().length==0){t.setHref("#/"+t.mProperties.key)}},handleUserNamePress:function(e){var t=new a({showHeader:false,placement:l.Bottom,content:[new s({text:"Logout",type:r.Transparent})]}).addStyleClass("sapMOTAPopover sapTntToolHeaderPopover");t.openBy(e.getSource())},onSideNavButtonPress:function(){var e=this.byId("toolPage");var t=e.getSideExpanded();this._setToggleButtonTooltip(t);e.setSideExpanded(!e.getSideExpanded())},_setToggleButtonTooltip:function(e){var t=this.byId("sideNavigationToggleButton");if(e){t.setTooltip("Large Size Navigation")}else{t.setTooltip("Small Size Navigation")}},_handleWindowResize:function(e){if(e.name==="Tablet"&&this._bExpanded||e.name==="Desktop"){this.onSideNavButtonPress();this._bExpanded=e.name==="Desktop"}}})});