sap.ui.define(["./BaseController","sap/ui/Device","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/Popover","sap/m/Button","sap/m/library","sap/ui/core/routing/History","sap/ui/core/EventBus"],function(e,t,o,n,s,a,i,r,l){"use strict";var u=i.ButtonType,d=i.PlacementType;return e.extend("frontend.bbs.controller.BBSSAPAddOnDashboard",{_bExpanded:false,getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onInit:async function(){var e=new n;const o=this.getOwnerComponent().getEventBus();var s=this.getOwnerComponent();var a=jQuery.sap.storage(jQuery.sap.storage.Type.local);this.oJWT=a.get("jwt");this.company=a.get("company");e.attachRequestFailed(function(e){o.publish("username","checktoken",{status:"error"});window.location.href="../index.html"});await e.loadData(backendUrl+"checkToken",null,true,"POST",false,false,{Authorization:"Bearer "+this.oJWT});var i=e.getData();o.publish("username","checktoken",{userName:i.user.name,roleId:i.user.role_id,roleName:i.role[0].name,status:"success"});this.getOwnerComponent().setModel(e,"userModel");this.getView().setModel(e,"userModel");this.getView().getModel("userModel").setProperty("/company",this.company);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());var r=this.getOwnerComponent().getModel("navigationList");this.getView().setModel(r);this._setToggleButtonTooltip(!t.system.desktop);var l=this.getRouter().getHashChanger().getHash();t.media.attachHandler(this._handleWindowResize,this);this.getRouter().attachRouteMatched(this.onRouteChange.bind(this));this.getOwnerComponent().getModel("navigationList").setProperty("/selectedKey",l);var u=this.getOwnerComponent().getModel("navigationList");var d=u.getData();d.navigation.forEach(function(e,t,o){e.is_visible=true;console.log(i.user.role_id);if(e.title=="Pillar Settings"){if(i.user.role_id!=2){e.is_visible=false}}if(e.title=="User Administration"){if(i.user.role_id!=1){e.is_visible=false}}});console.log(d);u.setData(d);u.refresh()},onRouteChange:function(e){this.getOwnerComponent().getModel("navigationList").setProperty("/selectedKey",e.getParameter("name"));if(t.system.phone){this.onSideNavButtonPress()}},onLogoutItemSelect:function(e){var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);var o=t.get("jwt");console.log(o);var n=this.getRouter();$.ajax({url:backendUrl+"logout",type:"POST",headers:{Authorization:"Bearer "+o},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){jQuery.sap.storage.clear();window.location.href="../index.html"},statusCode:{401:function(e,t,o){window.location.href="../index.html"},404:function(e,t,o){loginErrorToast.show()}}})},onParentItemSelect:function(e){var t=e.getSource();var o=this.getRouter();if(t.getItems().length==0){t.setHref("#/"+t.mProperties.key)}},handleUserNamePress:function(e){var t=new s({showHeader:false,placement:d.Bottom,content:[new a({text:"Change Company",type:u.Transparent})]}).addStyleClass("sapMOTAPopover sapTntToolHeaderPopover");t.openBy(e.getSource())},onSideNavButtonPress:function(){var e=this.byId("toolPage");var t=e.getSideExpanded();this._setToggleButtonTooltip(t);e.setSideExpanded(!e.getSideExpanded())},_setToggleButtonTooltip:function(e){var t=this.byId("sideNavigationToggleButton");if(e){t.setTooltip("Large Size Navigation")}else{t.setTooltip("Small Size Navigation")}},_handleWindowResize:function(e){if(e.name==="Tablet"&&this._bExpanded||e.name==="Desktop"){this.onSideNavButtonPress();this._bExpanded=e.name==="Desktop"}}})});