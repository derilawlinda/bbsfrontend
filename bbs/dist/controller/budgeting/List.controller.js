sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/ODataModel"],function(e,t,o,n){"use strict";var r;var a;var i=[];return e.extend("frontend.bbs.controller.budgeting.List",{onInit:async function(){this.getView().byId("idBudgetTable").setBusy(true);var e=this.getRouter().getHashChanger().getHash();var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);var n=t.get("jwt");var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);var n=t.get("jwt");var r=new o;r.loadData(backendUrl+"getBudget",null,true,"GET",false,false,{Authorization:"Bearer "+n});r.dataLoaded().then(function(){this.getView().byId("idBudgetTable").setBusy(false)}.bind(this));this.getOwnerComponent().setModel(r,"budgeting");var a=new o(sap.ui.require.toUrl("frontend/bbs/model/budgeting_accounts.json"));this.getView().setModel(a,"budgeting_accounts")},search:function(e,t){if(t!=r){i=[]}if(!Array.isArray(e))return i;var o=this;e.forEach(function(e){if(e.subheader===t){const o=e.nodes&&Array.isArray(e.nodes)?e.nodes.filter(e=>e.value===t):[];i.push(e)}else{o.search(e.nodes,t)}r=t});return i},onCreateButtonClick:function(e){if(!this.createBudgetingDialog){this.createBudgetingDialog=this.loadFragment({name:"frontend.bbs.view.budgeting.CreateForm"})}this.createBudgetingDialog.then(function(e){this.oDialog=e;this.oDialog.open();var t=new sap.ui.model.json.JSONModel({Date:new Date});this.getView().setModel(t,"createFragmentViewModel");var o=new sap.ui.model.json.JSONModel({U_TotalAmount:0});this.getView().setModel(o,"budgetingDetailModel");var n=new sap.ui.model.json.JSONModel;this.getView().setModel(n,"new_budgeting_accounts");this.getView().getModel("new_budgeting_accounts").setProperty("/BUDGETREQLINESCollection",[])}.bind(this))},onSaveButtonClick:function(e){const t=this.getView().getModel("budgetingDetailModel");const o=this.getView().getModel("new_budgeting_accounts");t.setProperty("/BUDGETREQLINESCollection",o.getData().BUDGETREQLINESCollection);var n=t.getProperty("/");var r=this.getView();var a=this.oDialog;$.ajax({type:"POST",data:JSON.stringify(n),crossDomain:true,url:backendUrl+"budget/createBudget",contentType:"application/json",success:function(e,t,o){console.log("Success");a.close();r.getModel("budgeting").refresh()},error:function(e,t,o){console.log("Got an error response: "+t+o)}})},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_closeDialog:function(){this.oDialog.close()},buttonFormatter:function(e){if(e=="Approved"){return"Accept"}else if(e==1){return"Attention"}else{return"Reject"}},textFormatter:function(e){if(e==1){return"Pending"}else if(e==2){return"Approved by Manager"}else if(e==3){return"Approved by Director"}else{return"Rejected"}},dateFormatter:function(e){var t=new Date(e);var o=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY-MM-dd"});var n=o.format(t);return n},onNavBack:function(e){var o,n;o=t.getInstance();n=o.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{this.getRouter().navTo("login",{},true)}},onPress:function(e){var t=this.getOwnerComponent().getRouter();var o=e.getSource().getBindingContextPath();var n=o.split("/").slice(-1).pop();t.navTo("budgetingDetail",{budgetID:n})},onAddPress:function(e){const t=this.getView().getModel("new_budgeting_accounts");var o=t.getData();var n={U_AccountCode:"",U_Amount:""};o.BUDGETREQLINESCollection.push(n);var r=new sap.ui.model.json.JSONModel(o);this.getView().setModel(r,"new_budgeting_accounts");r.refresh()},onAmountChange:function(e){const t=this.getView().getModel("new_budgeting_accounts");var o=t.getData().BUDGETREQLINESCollection;let n=0;for(let e=0;e<o.length;e++){n+=o[e]["U_Amount"]}const r=this.getView().getModel("budgetingDetailModel");console.log(r.getData());r.setProperty("/U_TotalAmount",n);console.log(r.getData())}})});