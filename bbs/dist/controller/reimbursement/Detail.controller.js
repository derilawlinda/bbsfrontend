sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/model/json/JSONModel"],function(e,t,r){"use strict";return e.extend("frontend.bbs.controller.reimbursement.Detail",{onInit:async function(){var e=this.getOwnerComponent();this.oRouter=e.getRouter();this.oRouter.getRoute("reimbursementDetail").attachPatternMatched(this._onObjectMatched,this);var t=new r(sap.ui.require.toUrl("frontend/bbs/model/items.json"));this.getView().setModel(t,"items")},_onObjectMatched:async function(e){var t=new sap.ui.model.json.JSONModel({NPWP:[{Name:0},{Name:2.5},{Name:3}]});this.getView().setModel(t,"viewModel");this.getView().byId("reimbursementPageId").setBusy(true);var o=jQuery.sap.storage(jQuery.sap.storage.Type.local);this.oJWT=o.get("jwt");var a=new r;await a.loadData(backendUrl+"checkToken",null,true,"POST",false,false,{Authorization:"Bearer "+this.oJWT});this.getView().bindElement({path:"/value/"+window.decodeURIComponent(e.getParameter("arguments").ID),model:"reimbursements"});var s=e.getParameter("arguments").ID;if(s===undefined){var i=window.location.href;var n=i.split("/");s=n[n.length-1]}const l=new r;l.loadData(backendUrl+"reimbursement/getReimbursementById?code="+s,null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getView().setModel(l,"reimbursementDetailModel");var u=new r;u.loadData(backendUrl+"budget/getApprovedBudget",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(u,"budgeting");l.dataLoaded().then(function(){var e=a.getData();var o=this.getView().getModel("reimbursementDetailModel").getData();if(e.user.role_id==4){t.setProperty("/editable",false);t.setProperty("/is_approver",true);t.setProperty("/is_requestor",false);if(o.U_Status==3){t.setProperty("/showFooter",false)}}else if(e.user.role_id==5){t.setProperty("/editable",false);t.setProperty("/is_approver",true);t.setProperty("/is_requestor",false);if(o.U_Status==2){t.setProperty("/showFooter",false)}}else if(e.user.role_id==3){t.setProperty("/is_approver",false);t.setProperty("/is_requestor",true);if(o.U_Status!=1){t.setProperty("/showFooter",false);t.setProperty("/editable",false)}}const s=new r;s.loadData(backendUrl+"budget/getBudgetById?code="+o.U_BudgetCode,null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(s,"budget");s.dataLoaded().then(function(){var e=s.getData();var t=e.U_TotalAmount;var r=e.BUDGETUSEDCollection;let o=0;for(let e=0;e<r.length;e++){o+=r[e]["U_Amount"]}e.U_RemainingBudget=t-o;var a=this.getView().getModel("budget");a.setData(e);this.getView().byId("reimbursementPageId").setBusy(false)}.bind(this))}.bind(this))},onNavBack:function(){var e=t.getInstance();var r=e.getPreviousHash();if(r!==undefined){window.history.go(-1)}else{var o=this.getOwnerComponent().getRouter();o.navTo("dashboard",{},true)}}})});