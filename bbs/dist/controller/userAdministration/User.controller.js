sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/Fragment","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/m/Dialog","sap/m/Button","sap/m/Label","sap/m/library","sap/m/MessageToast","sap/m/Text","sap/m/TextArea","sap/ui/model/json/JSONModel","sap/ui/core/library","frontend/bbs/utils/Validator"],function(e,t,s,r,a,o,i,n,l,u,d,c,g,h,p){"use strict";var f=l.ButtonType;var w=l.DialogType;var y=h.ValueState;return e.extend("frontend.bbs.controller.userAdministration.User",{onInit:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local);this.oJWT=e.get("jwt");console.log(this.oJWT);this.company=e.get("company");var t=new g;t.setSizeLimit(2e3);t.loadData(backendUrl+"getUsers",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(t,"userList");var s=new g;s.setSizeLimit(100);s.loadData(backendUrl+"getRoles",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(s,"roles")},roleFormatter:function(e){if(e==1){return"Administrator"}else if(e==2){return"Finance"}else if(e==3){return"Staff"}else if(e==4){return"Director"}else if(e==5){return"Manager"}},onCreateButtonClick:function(e){if(!this.createUserDialog){this.createUserDialog=this.loadFragment({name:"frontend.bbs.view.userAdministration.CreateForm"})}this.createUserDialog.then(function(e){var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"userCreate");this.oDialog=e;this.oDialog.open()}.bind(this))},_closeDialog:function(){this.oDialog.close()},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onSaveButtonClick:function(){var e=this.getView().getModel("userCreate");var t=this.getView().getModel("userList");var s=e.getData();s.role_id=this.getView().byId("role").getSelectedKey();var r=this.oJWT;var a=new p;var n=this.getView().byId("password").getValue();var l=this.getView().byId("password2").getValue();if(n!=null&&l!=null){if(n!=l){this.getView().byId("password").setValueState(y.Error);this.getView().byId("password").setValueStateText("Password inputted not the same");this.getView().byId("password2").setValueState(y.Error);this.getView().byId("password2").setValueStateText("Password inputted not the same")}else{this.getView().byId("password").setValueState(y.Success);this.getView().byId("password2").setValueState(y.Success)}}if(a.validate(this.byId("createUserForm"))){var c=this.oDialog;c.setBusy(true);$.ajax({type:"POST",data:JSON.stringify(s),crossDomain:true,headers:{Authorization:"Bearer "+r},url:backendUrl+"user/createUser",contentType:"application/json",success:function(e,s,a){c.setBusy(false);c.close();t.loadData(backendUrl+"getUsers",null,true,"GET",false,false,{Authorization:"Bearer "+r});t.refresh();u.show("Material Request created");$(".sapMMessageToast").css({"background-color":"#256f3a",color:"white"})},error:function(e,t,s){c.setBusy(false);if(!this.oErrorDialog){this.oErrorDialog=new o({type:w.Message,title:"Error",state:y.Error,content:new d({text:e.responseJSON.msg}),beginButton:new i({type:f.Emphasized,text:"OK",press:function(){this.oErrorDialog.close()}.bind(this)})})}this.oErrorDialog.open()}})}},onNavBack:function(e){var s,r;s=t.getInstance();r=s.getPreviousHash();if(r!==undefined){window.history.go(-1)}else{this.getRouter().navTo("login",{},true)}}})});