sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/Fragment","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/m/Dialog","sap/m/Button","sap/m/Label","sap/m/library","sap/m/MessageToast","sap/m/Text","sap/m/TextArea","sap/ui/model/json/JSONModel","sap/ui/core/library","frontend/bbs/utils/Validator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox"],function(e,t,a,s,r,o,i,n,l,u,g,d,c,p,h,f,w,m){"use strict";var v=l.ButtonType;var y=l.DialogType;var b=p.ValueState;return e.extend("frontend.bbs.controller.userAdministration.User",{onInit:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local);this.oJWT=e.get("jwt");console.log(this.oJWT);this.company=e.get("company");var t=new c;t.setSizeLimit(2e3);t.loadData(backendUrl+"getUsers",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(t,"userList");var a=new c;a.setSizeLimit(100);a.loadData(backendUrl+"getRoles",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(a,"roles")},roleFormatter:function(e){if(e==1){return"Administrator"}else if(e==2){return"Finance"}else if(e==3){return"Staff"}else if(e==4){return"Director"}else if(e==5){return"Manager"}},onCreateButtonClick:function(e){if(!this.createUserDialog){this.createUserDialog=this.loadFragment({name:"frontend.bbs.view.userAdministration.CreateForm"})}this.createUserDialog.then(function(e){var t=new sap.ui.model.json.JSONModel;this.getView().setModel(t,"userCreate");this.oDialog=e;this.oDialog.open()}.bind(this))},_closeDialog:function(){this.oDialog.close()},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onSaveButtonClick:function(){var e=this.getView().getModel("userCreate");var t=this.getView().getModel("userList");var a=e.getData();a.role_id=this.getView().byId("role").getSelectedKey();var s=this.oJWT;var r=new h;var o=this.getView().byId("password").getValue();var i=this.getView().byId("password2").getValue();if(o!=null&&i!=null){if(o!=i){this.getView().byId("password").setValueState(b.Error);this.getView().byId("password").setValueStateText("Password inputted not the same");this.getView().byId("password2").setValueState(b.Error);this.getView().byId("password2").setValueStateText("Password inputted not the same")}else{this.getView().byId("password").setValueState(b.Success);this.getView().byId("password2").setValueState(b.Success)}}if(r.validate(this.byId("createUserForm"))){var n=this.oDialog;n.setBusy(true);$.ajax({type:"POST",data:JSON.stringify(a),crossDomain:true,headers:{Authorization:"Bearer "+s},url:backendUrl+"user/createUser",contentType:"application/json",success:function(e,a,r){n.setBusy(false);n.close();t.loadData(backendUrl+"getUsers",null,true,"GET",false,false,{Authorization:"Bearer "+s});t.refresh();u.show("User created");$(".sapMMessageToast").css({"background-color":"#256f3a",color:"white"})},error:function(e,t,a){m.error(e.responseJSON.msg)}})}},onPress:function(e){var t=this.getOwnerComponent().getRouter();var a=e.getSource();var s=a.getCells()[0].getText();t.navTo("userDetail",{userID:s})},onNavBack:function(e){var a,s;a=t.getInstance();s=a.getPreviousHash();if(s!==undefined){window.history.go(-1)}else{this.getRouter().navTo("login",{},true)}},onSearch:function(e){var t=[];var a=e.getSource().getValue();if(a&&a.length>0){var s=new f({filters:[new f("name",w.Contains,a),new f("email",w.Contains,a)],and:false});t.push(s)}var r=this.byId("userTable");var o=r.getBinding("items");o.filter(t,"Application")}})});