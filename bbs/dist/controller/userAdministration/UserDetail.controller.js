sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/m/MessageToast","sap/m/Text","sap/m/TextArea","sap/ui/model/json/JSONModel","sap/ui/core/library","frontend/bbs/utils/Validator","sap/ui/core/routing/History","sap/m/MessageBox"],function(e,t,s,a,r,o,i,n,u,l){"use strict";var d=t.ButtonType;var h=t.DialogType;var c=i.ValueState;return e.extend("frontend.bbs.controller.userAdministration.UserDetail",{onInit:async function(){var e=this.getOwnerComponent();this.oRouter=e.getRouter();this.oRouter.getRoute("userDetail").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:async function(e){this.getView().byId("userPageID").setBusy(true);var t=jQuery.sap.storage(jQuery.sap.storage.Type.local);this.oJWT=t.get("jwt");var s=new o;console.log("Aaaaaa");await s.loadData(backendUrl+"checkToken",null,true,"POST",false,false,{Authorization:"Bearer "+this.oJWT});this.userId=e.getParameter("arguments").userID;console.log(this.userId);if(this.userId===undefined){var a=window.location.href;var r=a.split("/");this.userId=r[r.length-1]}var i=new o;i.setSizeLimit(100);i.loadData(backendUrl+"getRoles",null,true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});this.getOwnerComponent().setModel(i,"roles");const n=new o;this.getView().setModel(n,"userDetailModel");n.loadData(backendUrl+"user/getUserById",{id:this.userId},true,"GET",false,false,{Authorization:"Bearer "+this.oJWT});n.refresh();this.getView().byId("userPageID").setBusy(false)},onNavBack:function(e){var t,s;t=u.getInstance();s=t.getPreviousHash();if(s!==undefined){window.history.go(-1)}else{this.getRouter().navTo("login",{},true)}},onSaveButtonClick:function(e){var t=this.getView().getModel("userDetailModel");var a=t.getData();var r=this.oJWT;var o=new n;var i=this.getView().byId("password").getValue();var u=this.getView().byId("password2").getValue();if(i!=null&&u!=null){if(i!=u){this.getView().byId("password").setValueState(c.Error);this.getView().byId("password").setValueStateText("Password inputted not the same");this.getView().byId("password2").setValueState(c.Error);this.getView().byId("password2").setValueStateText("Password inputted not the same")}else{this.getView().byId("password").setValueState(c.Success);this.getView().byId("password2").setValueState(c.Success)}}if(o.validate(this.byId("editUserForm"))){$.ajax({type:"POST",data:JSON.stringify(a),crossDomain:true,headers:{Authorization:"Bearer "+r},url:backendUrl+"user/editUser",contentType:"application/json",success:function(e,t,a){s.show("User updated");$(".sapMMessageToast").css({"background-color":"#256f3a",color:"white"})},error:function(e,t,s){l.error(e.responseJSON.msg)}})}}})});